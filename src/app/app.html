<div class="retro-stage">
  <div class="retro-screen">
    <div class="desktop-shell">
      <header class="menu-bar">
    <div class="menu-left">
      <button type="button" class="os-mark" (click)="openApp('finder')">OS8</button>
      @for (item of menuItems; track item) {
        <button type="button" class="menu-item">{{ item }}</button>
      }
    </div>
    <div class="menu-right">
      <span>Portfolio Mode</span>
      <span>{{ timeLabel() }}</span>
    </div>
  </header>

      <main class="desktop-surface">
        <section class="window-layer" #windowLayer aria-label="Window layer">
          <div class="workspace-items" aria-label="Workspace icons">
            @for (item of workspaceItems; track item.name) {
              <button
                type="button"
                class="workspace-item"
                [class.file]="item.kind === 'file'"
                [style.grid-column]="item.column"
                [style.grid-row]="item.row"
                (click)="openWorkspaceItem(item)"
              >
                <span class="workspace-icon">{{ item.code }}</span>
                <span class="workspace-label">{{ item.name }}</span>
              </button>
            }
          </div>

          @for (windowState of windows(); track windowState.id) {
            @if (!windowState.minimized) {
              <article
                class="window"
                [class.active]="windowState.active"
                [style.width.px]="windowState.width"
                [style.height.px]="windowState.height"
                [style.left.px]="windowState.x"
                [style.top.px]="windowState.y"
                [style.z-index]="windowState.z"
                (mousedown)="activateWindow(windowState.id)"
              >
                <header class="window-titlebar" (pointerdown)="startDrag(windowState.id, windowLayer, $event)">
              <div class="window-controls" aria-label="Window controls">
                <button
                  type="button"
                  class="control red"
                  aria-label="Close window"
                  (click)="closeWindow(windowState.id, $event)"
                ></button>
                <button
                  type="button"
                  class="control amber"
                  aria-label="Minimize window"
                  (click)="minimizeWindow(windowState.id, $event)"
                ></button>
                <button
                  type="button"
                  class="control green"
                  [attr.aria-label]="windowState.maximized ? 'Restore window' : 'Open window'"
                  (click)="toggleOpenWindow(windowState.id, windowLayer, $event)"
                ></button>
              </div>
              <p>{{ windowState.title }}</p>
                </header>

                <div class="window-content">
              @switch (windowState.appId) {
                @case ('about') {
                  <h1>{{ getWindowContentTitle(windowState.appId) }}</h1>
                  <p>
                    This shell now has a real window manager with stacking,
                    dragging, minimizing, and app-based launch actions.
                  </p>
                  <div class="window-pills">
                    <span>Angular</span>
                    <span>Window Manager</span>
                    <span>Virtual Desktop</span>
                  </div>
                }

                @case ('projects') {
                  <h1>{{ getWindowContentTitle(windowState.appId) }}</h1>
                  <div class="project-grid">
                    @for (project of projectItems; track project.name) {
                      <a
                        class="project-card"
                        [href]="project.href"
                        target="_blank"
                        rel="noopener"
                      >
                        <h2>{{ project.name }}</h2>
                        <p>{{ project.summary }}</p>
                        <span>Open case study</span>
                      </a>
                    }
                  </div>
                }

                @case ('terminal') {
                  <h1>{{ getWindowContentTitle(windowState.appId) }}</h1>
                  <div class="terminal-output">
                    @for (line of terminalLines(); track $index) {
                      <p>{{ line }}</p>
                    }
                    <form class="terminal-input-row" (submit)="$event.preventDefault(); submitTerminalCommand()">
                      <label for="terminal-command">welcome@macos8:~$</label>
                      <input
                        id="terminal-command"
                        type="text"
                        [value]="terminalInput()"
                        (input)="updateTerminalInput($event)"
                        autocomplete="off"
                        spellcheck="false"
                        placeholder="Type a command"
                      />
                    </form>
                  </div>
                }

                @case ('notes') {
                  <h1>{{ getWindowContentTitle(windowState.appId) }}</h1>
                  <textarea readonly>
This is a placeholder Notes app.

Next milestones:
- Persist app state
- Build command parser for terminal
- Add project pages and routing
                  </textarea>
                }

                @case ('textviewer') {
                  <h1>{{ openedFileName() }}</h1>
                  <pre class="file-preview">{{ openedFileContent() }}</pre>
                }

                @case ('finder') {
                  <h1>{{ getWindowContentTitle(windowState.appId) }}</h1>
                  <p>Explore files, open apps, and navigate your portfolio desktop.</p>
                  <div class="finder-grid">
                    <span>Portfolio</span>
                    <span>Assets</span>
                    <span>Experiments</span>
                    <span>Archive</span>
                  </div>
                }
              }
                </div>
              </article>
            }
          }
        </section>
      </main>

      <footer class="dock" aria-label="App dock">
        @for (app of dockApps; track app.name) {
          <button
            type="button"
            class="dock-item"
            [class.active]="isAppOpen(app.appId)"
            [class.running]="isAppRunning(app.appId)"
            [class.minimized]="isAppMinimized(app.appId)"
            (click)="openApp(app.appId)"
          >
            <span>{{ app.code }}</span>
            <small>{{ app.name }}</small>
          </button>
        }
      </footer>
    </div>
  </div>
</div>
